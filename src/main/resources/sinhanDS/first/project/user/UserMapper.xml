<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sinhanDS.first.project.user.UserMapper">

	<select id="check_password" parameterType="sinhanDS.first.project.user.VO.UserVO" resultType="int">
		SELECT count(*) FROM user WHERE no = #{no} AND password = MD5(#{password})
	</select>
	
	<update id="edit" parameterType="sinhanDS.first.project.user.VO.UserVO">
		UPDATE user SET
			<if test="password != ''">
				password = MD5(#{new_password}),
			</if>
			name = #{name},
			email = #{email},
			phone = #{phone},
			gender = #{gender},
			birth_date = #{birth_date},
			advertisement = #{advertisement}
		WHERE no = #{no}
	</update>
	
	<select id="detail" parameterType="int" resultType="sinhanDS.first.project.user.VO.UserVO">
		SELECT * FROM user WHERE no = #{no}
	</select>
	
	<select id="login" parameterType="sinhanDS.first.project.user.VO.UserVO" resultType="sinhanDS.first.project.user.VO.UserVO">
		SELECT * FROM user WHERE id=#{id} AND password=MD5(#{password})
	</select>
	
	<insert id="user_regist" parameterType="sinhanDS.first.project.user.VO.UserVO">
		INSERT INTO user (
			id, name, email, password, phone, birth_date, gender, advertisement , join_date
		) VALUES (
			#{id}, #{name}, #{email}, MD5(#{password}), #{phone}, #{birth_date}, #{gender}, #{advertisement} , NOW()
		)
		<selectKey keyProperty="no" order="AFTER" resultType="int">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	
	<insert id="initaddr_regist" parameterType="sinhanDS.first.project.user.VO.UserAddressVO">
		INSERT INTO address (
			user_no, zipcode, addr1, addr2, name, phone, comment
		) VALUES (
			#{user_no}, #{zipcode}, #{addr1}, #{addr2}, #{name}, #{phone}, '기본'
		);
	</insert>
	
	<insert id="user_address_regist" parameterType="sinhanDS.first.project.user.VO.UserVO">
		<!-- 생각해보니 저희 이거 uservo로 못받아옴........새 vo하나 파야할거같음; -->
	</insert>
	
	<select id="exist_addr" parameterType="int" resultType="sinhanDS.first.project.user.VO.UserAddressVO">
		SELECT * FROM address WHERE user_no = #{no}
	</select>	
</mapper>